{"version":3,"file":"HmrServer.js","sourceRoot":"","sources":["../../src/electron-main-hmr/HmrServer.ts"],"names":[],"mappings":";;;;;;;;;AAAA,AAAO,AAAe,AAAM,AAAc;;;;;;AAC1C,AAAO,AAAO,AAAM,AAAS;;;;;;AAG7B,MAAM,AAAK,QAAG,AAAO,QAAC,AAAO,AAAC,SAAC,AAA6B,AAAC,AAE7D,AAAM;;AAAN;AACU,aAAK,QAAG,AAAK;AACZ,aAAG,MAAG,AAAI,AAAO,AAAE,AAmC9B;AAAC;AAjCC,AAAM;AACJ,AAAM,iEAAqB,CAAC,AAAO,SAAE,AAAM,AAAE,AAAE;AAC7C,kBAAM,AAAU,AAAG,uCAA0B,AAAO,QAAC,AAAG,IAAC,AAAQ,SAAC,AAAE,AAAC,GAAO;AAC5E,AAAI,iBAAC,AAAG,IAAC,AAAM,OAAC,EAAC,AAAI,MAAE,AAAU,AAAC,cAAE,AAAK,AAAC,AAAE;AAC1C,AAAE,AAAC,oBAAC,AAAK,SAAI,AAAI,AAAC,MAAC,AAAC;AAClB,AAAM,2BAAC,AAAK,AAAC,AACf;AAAC;AACD,AAAE,AAAC,oBAAC,AAAK,MAAC,AAAO,AAAC,SAAC,AAAC;AAClB,AAAK,AAAC,qDAA2B,AAAU,UAAE,AAAC,AAChD;AAAC;AACD,AAAO,wBAAC,AAAU,AAAC,AACrB;AAAC,AAAC,AACJ;AAAC,AAAC,AACJ,SAZS,AAAI,AAAe;AAY3B;AAED,AAAa;AACX,AAAI,aAAC,AAAK,QAAG,AAAK,AACpB;AAAC;AAED,AAAK,UAAC,AAAY;AAChB,AAAI,aAAC,AAAK,QAAG,AAAI;AACjB,AAAY,qBAAC,AAAG,AAAE;AAChB,AAAE,AAAC,gBAAC,CAAC,AAAI,KAAC,AAAK,AAAC,OAAC,AAAC;AAChB,AAAM,AACR;AAAC;AAED,kBAAM,AAAI,OAAG,AAAK,MAAC,AAAM,OAAC,EAAC,AAAM,QAAE,AAAK,OAAE,AAAM,QAAE,AAAK,OAAE,AAAQ,UAAE,AAAK,OAAE,AAAO,SAAE,AAAK,AAAC,AAAC,SAAC,AAAI;AAC/F,AAAE,AAAC,gBAAC,AAAK,MAAC,AAAO,AAAC,SAAC,AAAC;AAClB,AAAK,AAAC,0CAAoB,AAAI,IAAE,AAAC,AACnC;AAAC;AACD,AAAI,iBAAC,AAAG,IAAC,AAAI,KAAC,AAAQ,UAAE,EAAC,AAAI,AAAC,AAAC,AACjC;AAAC,AAAC,AACJ;AAAC,AACF","sourcesContent":["import BluebirdPromise from \"bluebird-lst\"\nimport Crocket from \"crocket\"\nimport { Stats } from \"webpack\"\n\nconst debug = require(\"debug\")(\"electron-webpack:dev-runner\")\n\nexport class HmrServer {\n  private state = false\n  readonly ipc = new Crocket()\n\n  listen(): Promise<string> {\n    return new BluebirdPromise((resolve, reject) => {\n      const socketPath = `/tmp/electron-main-ipc-${process.pid.toString(16)}.sock`\n      this.ipc.listen({path: socketPath}, error => {\n        if (error != null) {\n          reject(error)\n        }\n        if (debug.enabled) {\n          debug(`HMR Server listening on ${socketPath}`)\n        }\n        resolve(socketPath)\n      })\n    })\n  }\n\n  beforeCompile() {\n    this.state = false\n  }\n\n  built(stats: Stats): void {\n    this.state = true\n    setImmediate(() => {\n      if (!this.state) {\n        return\n      }\n\n      const hash = stats.toJson({assets: false, chunks: false, children: false, modules: false}).hash\n      if (debug.enabled) {\n        debug(`Send built: hash ${hash}`)\n      }\n      this.ipc.emit(\"/built\", {hash})\n    })\n  }\n}"]}
